openapi: 3.0.0
info:
  title: LOOPy API(테스트)
  description: 루피 프로젝트 백엔드 API 문서입니다!
  version: 1.0.0

servers:
  - url: https://loopyxyz.duckdns.org
    description: 서버 배포 도메인 

security:
  - bearerAuth: []

paths:
  /health:
    get:
      summary: 헬스 체크
      description: 서버가 정상 작동 중인지 확인하기 위한 API
      tags:
        - Health
      responses:
        "200":
          description: 서버 작동 정상
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: string
                    example: 루피 백엔드 작동 중!
    
  /api/v1/auth/signup:
    post:
      summary: 이메일 회원가입
      description: 사용자가 이메일, 비밀번호, 닉네임, 전화번호, 사용자 역할, 알림 수신 동의 및 약관 동의 정보를 제출하여 회원가입
      tags:
        - Auth
      security: [] 
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: test@example.com
              password: securepassword123
              nickname: 테스터
              phoneNumber: "01012345678"
              role: CUSTOMER
              allowKakaoAlert: true
              agreements:
                termsAgreed: true
                privacyPolicyAgreed: true
                marketingAgreed: false
                locationPermission: true
      responses:
        '201':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 회원가입 성공
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: 잘못된 요청 (필수 항목 누락 또는 중복된 이메일 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/login:
    post:
      summary: 이메일 로그인
      description: 사용자가 이메일과 비밀번호로 로그인, JWT 토큰과 사용자 정보를 발급
      tags:
        - Auth
      security: [] 
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 로그인 성공
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/LoginUserProfile'
        '400':
          description: 이메일 또는 비밀번호 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /api/v1/auth/logout:
    post:
      summary: 로그아웃
      description: JWT 토큰을 사용하여 인증된 사용자의 로그아웃 처리
      tags:
        - Auth
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 로그아웃 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 로그아웃 완료
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/qrcode:
    get:
      summary: 사용자 QR 코드 조회
      description: |
        회원가입 시 자동 생성된 사용자의 QR 코드를 조회합니다.  
        QR 코드는 사용자 ID를 기반으로 생성되며, 값이 변하지 않습니다.
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: QR 코드 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  success:
                    type: object
                    properties:
                      userId:
                        type: integer
                        example: 1
                      qrCodeImage:
                        type: string
                        description: data:image/png;base64 형식의 QR 코드 이미지 문자열
                        example: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIC...
        '401':
          description: 인증 실패 (토큰 누락 또는 만료)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: QR 코드 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'



  /api/v1/points/current:
    get:
      summary: 현재 포인트 조회
      description: 인증된 사용자의 현재 보유 포인트를 조회
      tags:
        - Point
      security:
        - bearerAuth: []
      responses:
        "200":
          description: 현재 포인트 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 현재 포인트 조회 성공
                      currentPoint:
                        type: integer
                        example: 1200
        "401":
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/v1/users/me/fcm-token:
    patch:
      summary: FCM 토큰 저장
      description: 사용자의 FCM 푸시 알림 토큰을 저장
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FcmTokenRequest'
      responses:
        '200':
          description: FCM 토큰 저장 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      message:
                        type: string
                        example: fcmToken이 저장되었습니다.
        '400':
          description: 잘못된 요청 (fcmToken 누락 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/inactive:
    patch:
      summary: 휴면 계정 전환
      description: 인증된 사용자의 계정을 휴면 상태(`inactive`)로 전환
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 계정 휴면 전환 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 계정이 휴면 상태로 전환되었습니다.
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "1"
                      status:
                        type: string
                        enum: [active, inactive]
                        example: inactive
                      inactivedAt:
                        type: string
                        format: date-time
                        example: "2025-07-17T15:46:09.924Z"
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/activate:
    patch:
      summary: 휴면 계정 활성화
      description: 휴면 상태인 계정을 다시 활성화
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 계정 활성화 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 계정이 다시 활성화되었습니다.
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "1"
                      status:
                        type: string
                        enum: [active, inactive]
                        example: active
                      inactivedAt:
                        type: string
                        nullable: true
                        example: null
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/verify-phone:
    post:
      summary: SMS 인증 확인 및 전화번호 저장
      description: Firebase에서 발급한 ID 토큰을 검증하여 인증된 사용자의 전화번호를 저장합니다. 이때 사용자 ID는 프론트에서 함께 전달되어야 합니다.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PhoneVerificationRequest'
            example:
              idToken: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
              userId: 12
      responses:
        '200':
          description: 전화번호 저장 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 전화번호 등록 완료
                  userId:
                    type: integer
                    example: 12
                  phoneNumber:
                    type: string
                    example: "+821012345678"
        '400':
          description: 잘못된 요청 (idToken 또는 userId 누락, 또는 전화번호 없음)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패 (idToken 유효하지 않음)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me:
    get:
      summary: 사용자 정보 조회
      description: 인증된 사용자의 정보를 조회
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 사용자 정보 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/UserProfile'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/nickname:
    patch:
      summary: 닉네임 수정
      description: 인증된 사용자의 닉네임을 수정
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NicknameUpdateRequest'
      responses:
        '200':
          description: 닉네임 수정 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 닉네임이 성공적으로 변경되었습니다.
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "2"
                      nickname:
                        type: string
                        example: 새로운닉네임
                      updatedAt:
                        type: string
                        format: date-time
                        example: "2025-07-18T06:49:44.605Z"
        '400':
          description: 잘못된 닉네임 형식
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/agreements:
    post:
      summary: 약관 동의 저장
      description: 인증된 사용자의 약관 동의 상태를 저장
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserAgreementRequest'
      responses:
        '200':
          description: 약관 동의 저장 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 약관 동의 저장 완료
                  agreement:
                    $ref: '#/components/schemas/UserAgreementResponse'
        '400':
          description: 필수 항목 누락 또는 잘못된 값
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/preferences:
    patch:
      summary: 선호 키워드 저장
      description: 인증된 사용자의 선호 키워드 목록을 저장하거나 업데이트합니다. 키워드는 카페 편의시설, 테이크아웃 혜택, 메뉴 특성 등으로 구분됩니다.
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserKeywordPreferenceRequest'
            example:
              preferredKeywords: ["노트북", "1인석", "디카페인", "텀블러 할인"]
      responses:
        '200':
          description: 키워드 저장 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 선호 키워드가 저장되었습니다.
                  storeFilters:
                    type: object
                    example:
                      노트북: true
                      1인석: true
                      단체석: false
                      주차 가능: false
                      예약 가능: false
                      와이파이 제공: false
                      애견 동반: false
                      24시간 운영: false
                  takeOutFilters:
                    type: object
                    example:
                      텀블러 할인: true
                      포장 할인: false
                  menuFilters:
                    type: object
                    example:
                      비건: false
                      디카페인: true
                      글루텐프리: false
                      저당/무가당: false
        '400':
          description: 잘못된 요청 (키워드 형식 오류 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /api/v1/users/me/preferred-area:
    patch:
      summary: 자주 가는 동네 저장
      description: 인증된 사용자의 선호 지역(동네)을 저장하거나 업데이트
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserPreferredAreaRequest'
      responses:
        '200':
          description: 동네 저장 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 자주 가는 동네가 저장되었습니다.
                      preferredArea:
                        type: string
                        example: 서울 마포구 신촌동
        '400':
          description: 유효하지 않은 동네명
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/kakao-alert:
    patch:
      summary: 카카오 알림톡 허용 여부 저장
      description: 인증된 사용자의 카카오 알림톡 수신 여부를 저장
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/KakaoAlertSettingRequest'
      responses:
        '200':
          description: 설정 저장 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 카카오 알림톡이 허용되었습니다.
        '400':
          description: 잘못된 요청 (allowKakaoAlert 누락 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/bookmarks:
    get:
      summary: 북마크한 카페 목록 조회
      description: 인증된 사용자가 북마크한 카페 목록을 조회
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 북마크 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 북마크한 카페 목록 조회 성공
                      bookmarks:
                        type: array
                        items:
                          $ref: '#/components/schemas/BookmarkedCafe'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/bookmarks:
    patch:
      summary: 북마크 추가
      description: 인증된 사용자가 특정 카페를 북마크
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookmarkRequest'
      responses:
        '200':
          description: 북마크 저장 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 북마크가 저장되었습니다.
                      cafeId:
                        type: string
                        example: "1"
        '400':
          description: 잘못된 요청 또는 이미 북마크된 카페
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/bookmarks/{cafeId}:
    delete:
      summary: 북마크 삭제
      description: 인증된 사용자가 특정 카페의 북마크를 삭제
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - name: cafeId
          in: path
          required: true
          description: 삭제할 카페의 ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: 북마크 삭제 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      message:
                        type: string
                        example: 북마크가 삭제되었습니다.
                      cafeId:
                        type: string
                        example: "1"
        '400':
          description: 존재하지 않는 북마크 또는 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/points/transactions:
    get:
      summary: 포인트 거래 내역 조회
      description: 인증된 사용자의 포인트 적립/사용/환불 내역을 최신순으로 조회
      tags:
        - Point
      security:
        - bearerAuth: []
      responses:
        "200":
          description: 포인트 거래 내역 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: array
                    items:
                      $ref: "#/components/schemas/PointTransaction"
        "401":
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"


  /api/v1/cafes/{cafeId}:
    get:
      tags:
        - Cafe
      summary: 카페 상세 정보 조회
      description: 카페 ID를 기반으로 상세 정보, 메뉴, 사진, 쿠폰, 스탬프북, 즐겨찾기 여부를 조회합니다
      operationId: getCafeDetail
      security:
        - BearerAuth: []
      parameters:
        - name: cafeId
          in: path
          description: 조회할 카페의 ID
          required: true
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: 성공적으로 카페 상세 정보를 조회했습니다
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeDetailResponse'
              example:
                resultType: "SUCCESS"
                error: null
                success:
                  cafe:
                    id: 1
                    name: "로스터리 카페"
                    address: "서울시 강남구 테헤란로 123"
                    businessHours:
                      - day: "MONDAY"
                        isClosed: false
                        openTime: "09:00"
                        closeType: "21:00"
                        breakStart: "14:00"
                        breakEnd: "15:00"
                      - day: "TUESDAY"
                        isClosed: true
                    phone: "02-1234-5678"
                    websiteUrl: "https://roastery-cafe.com"
                    description: "신선한 원두를 직접 로스팅하는 스페셜티 커피 전문점입니다."
                    storeFilters:
                      "1인석": true
                      "단체석": false
                      "노트북석": true
                      "애견 동반": false
                      "예약 가능": false
                      "주차 가능": true
                      "24시간 운영": false
                      "와이파이 제공": true
                    takeOutFilters:
                      "포장 할인": false
                      "텀블러 할인": true
                    menuFilters:
                      "비건": false
                      "디카페인": true
                      "글루텐프리": true
                      "저당/무가당": true
                    keywords:
                      - "커피"
                      - "로스팅"
                  photos:
                    - id: 1
                      url: "https://example.com/photos/roastery-exterior.jpg"
                      displayOrder: 1
                    - id: 2
                      url: "https://example.com/photos/roastery-interior.jpg"
                      displayOrder: 2
                    - id: 3
                      url: "https://example.com/photos/roastery-counter.jpg"
                      displayOrder: 3
                    - id: 4
                      url: "https://example.com/photos/roastery-beans.jpg"
                      displayOrder: 4
                    - id: 5
                      url: "https://example.com/photos/roastery-seating.jpg"
                      displayOrder: 5
                  menu:
                    - id: 1
                      name: "시그니처 아메리카노"
                      price: 4500
                      description: "하우스 블렌드 원두로 추출한 깔끔한 아메리카노"
                      imgUrl: "https://example.com/menu/signature-americano.jpg"
                      isSoldOut: false
                    - id: 2
                      name: "바닐라 라떼"
                      price: 5500
                      description: "마다가스카르 바닐라 시럽이 들어간 부드러운 라떼"
                      imgUrl: "https://example.com/menu/vanilla-latte.jpg"
                      isSoldOut: false
                    - id: 3
                      name: "케냐 AA 핸드드립"
                      price: 7000
                      description: "산미가 살아있는 케냐 원두 핸드드립"
                      imgUrl: "https://example.com/menu/kenya-drip.jpg"
                      isSoldOut: true
                    - id: 4
                      name: "티라미수"
                      price: 6500
                      description: "이탈리아 전통 방식으로 만든 수제 티라미수"
                      imgUrl: "https://example.com/menu/tiramisu.jpg"
                      isSoldOut: false
                    - id: 5
                      name: "콜드브루"
                      price: 5000
                      description: "18시간 저온추출한 시원한 콜드브루"
                      imgUrl: "https://example.com/menu/coldbrew.jpg"
                      isSoldOut: false
                  coupons:
                    - id: 1
                      name: "시그니처 아메리카노 무료"
                      validDays: 30
                      discountType: "fixed"
                      discountValue: 4500
                      applicableMenu: null
                      expiredAt: "2025-12-31T23:59:59.000Z"
                    - id: 2
                      name: "전 메뉴 15% 할인"
                      validDays: 7
                      discountType: "percentage"
                      discountValue: 15
                      applicableMenu: null
                      expiredAt: "2025-11-30T23:59:59.000Z"
                    - id: 5
                      name: "디저트 무료 쿠폰"
                      validDays: 60
                      discountType: "fixed"
                      discountValue: 6500
                      applicableMenu: null
                      expiredAt: "2026-02-28T23:59:59.000Z"
                  stampBook:
                    id: 1
                    currentCount: 3
                    goalCount: 10
                    expiresAt: "2025-12-31T23:59:59.000Z"
                    stampBookId: 1
                  bookmark:
                    isBookmarked: false
        '401':
          description: 인증 실패 (토큰 누락 또는 만료)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeDetailErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "UNAUTHORIZED"
                  message: "유효하지 않은 토큰입니다"
                success: null
        '404':
          description: 존재하지 않는 카페
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeDetailErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "CAFE_NOT_FOUND"
                  message: "해당 카페를 찾을 수 없습니다"
                success: null
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeDetailErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "INTERNAL_SERVER_ERROR"
                  message: "서버 내부 오류가 발생했습니다"
                success: null


  /api/v1/cafes/{cafeId}/review:
    get:
      summary: 카페 리뷰 목록 조회 (페이징 지원)
      description: 카페 ID를 기반으로 리뷰를 커서 기반 페이징 방식으로 조회합니다.
      tags:
        - Cafe
      parameters:
        - in: path
          name: cafeId
          required: true
          schema:
            type: integer
          description: 리뷰를 조회할 카페 ID
        - in: query
          name: cursor
          required: false
          schema:
            type: integer
          description: 다음 페이지 조회를 위한 커서 (이전 응답의 nextCursor 값)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 성공적으로 리뷰를 반환함
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      reviews:
                        type: array
                        items:
                          type: object
                          properties:
                            id: { type: integer, example: 1 }
                            title: { type: string, example: "로스터리 커피 맛집!" }
                            content: { type: string, example: "원두를 직접 로스팅해서 향이 정말 좋아요..." }
                            nickname: { type: string, example: "커피러버" }
                            createdAt: { type: string, format: date-time, example: "2025-07-19T10:30:00.000Z" }
                            images:
                              type: array
                              items:
                                type: string
                                format: uri
                      nextCursor:
                        type: integer
                        nullable: true
                        example: 10
                      hasNextPage:
                        type: boolean
                        example: true
        '401':
          description: 인증 실패 (토큰 없음/만료)
        '404':
          description: 해당 카페 또는 리뷰 없음
  
  /api/v1/cafes/{cafeId}/coupon:
    post:
      summary: 쿠폰 발급
      description: 사용자가 쿠폰 템플릿을 기반으로 프로모션 쿠폰을 발급받습니다.
      tags:
        - Cafe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - validDays
              properties:
                id:
                  type: integer
                  description: 발급할 쿠폰 템플릿의 ID
                  example: 1
                validDays:
                  type: integer
                  description: 쿠폰의 유효 기간(일 단위)
                  example: 60
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 쿠폰 발급 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      id: { type: integer, example: 14 }
                      expiredAt: { type: string, format: date-time, example: "2025-09-22T04:46:43.364Z" }
                      acquisitionType: { type: string, example: promotion }
                      couponTemplateId: { type: integer, example: 1 }
                      couponTemplate:
                        type: object
                        properties:
                          id: { type: integer, example: 1 }
                          name: { type: string, example: "시그니처 아메리카노 무료" }
                          validDays: { type: integer, example: 30 }
                          discountType: { type: string, enum: [fixed, percentage], example: fixed }
                          discountValue: { type: number, example: 4500 }
                          applicableMenu: { type: "null" }
                          expiredAt: { type: string, format: date-time, example: "2025-12-31T23:59:59.000Z" }
        '409':
          description: 이미 발급받은 쿠폰 (중복 발급 방지)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errorCode:
                    type: string
                    example: C002
                  reason:
                    type: string
                    example: 이미 발급받은 쿠폰입니다. 쿠폰 템플릿 ID: 1, 사용자 ID: 1
                  data:
                    type: object
                    properties:
                      couponTemplateId: { type: integer, example: 1 }
                      userId: { type: integer, example: 1 }
        '401':
          description: 인증 실패 (JWT 누락 또는 유효하지 않음)  

  /api/v1/cafes/{cafeId}/bookmark:
    post:
      summary: 카페 북마크 생성
      description: 사용자가 특정 카페를 북마크합니다. 이미 북마크된 카페는 중복 저장되지 않습니다.
      tags:
        - Cafe
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  description: 북마크할 카페의 ID
                  example: 1
      responses:
        '200':
          description: 북마크 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType:
                    type: string
                    example: SUCCESS
                  error:
                    type: "null"
                    example: null
                  success:
                    type: object
                    properties:
                      id:
                        type: integer
                        description: 생성된 북마크 ID
                        example: 5
        '409':
          description: 이미 북마크한 카페
          content:
            application/json:
              schema:
                type: object
                properties:
                  errorCode:
                    type: string
                    example: BM001
                  reason:
                    type: string
                    example: 이미 북마크한 카페입니다.
                  data:
                    type: "null"
                    example: null

  /api/v1/search/{cafeId}:
    get:
      tags:
        - search
      summary: 카페 정보 조회
      description: 카페 ID로 특정 카페의 상세 정보를 조회합니다
      operationId: getCafeInfo
      security:
        - BearerAuth: []
      parameters:
        - name: cafeId
          in: path
          description: 카페 고유 ID
          required: true
          schema:
            type: string
            example: "1"
        - name: x
          in: query
          description: X 좌표 (경도)
          required: false
          schema:
            type: number
            format: double
            example: 127.027610
        - name: y
          in: query
          description: Y 좌표 (위도)
          required: false
          schema:
            type: number
            format: double
            example: 37.497942
      responses:
        '200':
          description: 성공적으로 카페 정보를 조회했습니다
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeSearchResponse'
              example:
                resultType: "SUCCESS"
                error: null
                success:
                  id: "1"
                  name: "로스터리 카페"
                  keywords:
                    - "커피"
                    - "로스팅"
                  photos:
                    - id: "1"
                      url: "https://example.com/photos/roastery-exterior.jpg"
                      displayOrder: 1
                    - id: "2"
                      url: "https://example.com/photos/roastery-interior.jpg"
                      displayOrder: 2
                    - id: "3"
                      url: "https://example.com/photos/roastery-counter.jpg"
                      displayOrder: 3
                    - id: "4"
                      url: "https://example.com/photos/roastery-beans.jpg"
                      displayOrder: 4
                    - id: "5"
                      url: "https://example.com/photos/roastery-seating.jpg"
                      displayOrder: 5
                  distance: 100
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeSearchErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "INVALID_PARAMETER"
                  message: "유효하지 않은 좌표입니다"
                success: null
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeSearchErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "UNAUTHORIZED"
                  message: "유효하지 않은 토큰입니다"
                success: null
        '404':
          description: 카페를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeSearchErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "CAFE_NOT_FOUND"
                  message: "해당 위치에서 카페를 찾을 수 없습니다"
                success: null
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeSearchErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "INTERNAL_SERVER_ERROR"
                  message: "서버 내부 오류가 발생했습니다"
                success: null

  /api/v1/search/map:
    get:
      tags:
        - search
      summary: 지도 기반 카페 검색
      description: 좌표와 줌 레벨을 기반으로 주변 카페를 검색하고 다양한 필터를 적용합니다
      operationId: searchCafesOnMap
      security:
        - BearerAuth: []
      parameters:
        - name: x
          in: query
          description: X 좌표 (경도)
          required: true
          schema:
            type: number
            format: double
            example: 127.027926
        - name: y
          in: query
          description: Y 좌표 (위도)
          required: true
          schema:
            type: number
            format: double
            example: 37.497175
        - name: zoom
          in: query
          description: 지도 줌 레벨
          required: true
          schema:
            type: integer
            example: 3
            minimum: 1
            maximum: 20
        - name: store
          in: query
          description: 매장 필터 (콤마로 구분된 값들)
          required: false
          schema:
            type: string
            example: "wifi,parking"
            enum: 
              - single_seat
              - group_seat
              - laptop_seat
              - pet_friendly
              - reservation
              - parking
              - 24hours
              - wifi
          explode: false
          style: form
        - name: menu
          in: query
          description: 메뉴 필터 (콤마로 구분된 값들)
          required: false
          schema:
            type: string
            example: "vegan,decaf"
            enum:
              - vegan
              - decaf
              - gluten_free
              - sugar_free
          explode: false
          style: form
        - name: takeout
          in: query
          description: 테이크아웃 필터 (콤마로 구분된 값들)
          required: false
          schema:
            type: string
            example: "package_discount,tumbler_discount"
            enum:
              - package_discount
              - tumbler_discount
          explode: false
          style: form
      responses:
        '200':
          description: 성공적으로 카페 목록을 조회했습니다
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeMapSearchResponse'
              examples:
                basic_search:
                  summary: 기본 검색 (필터 없음)
                  value:
                    resultType: "SUCCESS"
                    error: null
                    success:
                      cafes:
                        - id: 10
                          name: "스타벅스 강남역점"
                          latitude: 37.497175
                          longitude: 127.027926
                          isBookmarked: false
                        - id: 11
                          name: "투썸플레이스 강남점"
                          latitude: 37.498234
                          longitude: 127.029871
                          isBookmarked: false
                        - id: 13
                          name: "카페베네 강남역점"
                          latitude: 37.495876
                          longitude: 127.025431
                          isBookmarked: false
                      totalCount: 3
                      searchRadius: 320
                      zoomLevel: "3"
                      center:
                        x: 127.027926
                        y: 37.497175
                filtered_search:
                  summary: 필터 적용 검색 (wifi 필터)
                  value:
                    resultType: "SUCCESS"
                    error: null
                    success:
                      cafes:
                        - id: 10
                          name: "스타벅스 강남역점"
                          latitude: 37.497175
                          longitude: 127.027926
                          isBookmarked: false
                        - id: 11
                          name: "투썸플레이스 강남점"
                          latitude: 37.498234
                          longitude: 127.029871
                          isBookmarked: false
                        - id: 13
                          name: "카페베네 강남역점"
                          latitude: 37.495876
                          longitude: 127.025431
                          isBookmarked: false
                        - id: 12
                          name: "블루보틀 강남점"
                          latitude: 37.499123
                          longitude: 127.030945
                          isBookmarked: false
                        - id: 14
                          name: "로컬카페 '소소한하루'"
                          latitude: 37.500456
                          longitude: 127.032187
                          isBookmarked: false
                        - id: 1
                          name: "로스터리 카페"
                          latitude: 37.5009
                          longitude: 127.0363
                          isBookmarked: true
                      totalCount: 6
                      searchRadius: 2560
                      zoomLevel: "6"
                      center:
                        x: 127.027926
                        y: 37.497175
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeMapSearchErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "INVALID_PARAMETER"
                  message: "유효하지 않은 좌표 또는 줌 레벨입니다"
                success: null
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeMapSearchErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "UNAUTHORIZED"
                  message: "유효하지 않은 토큰입니다"
                success: null
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CafeMapSearchErrorResponse'
              example:
                resultType: "ERROR"
                error:
                  code: "INTERNAL_SERVER_ERROR"
                  message: "서버 내부 오류가 발생했습니다"
                success: null

  /api/v1/challenges:
  get:
    summary: 챌린지 목록 조회
    description: 현재 유효한 챌린지 목록을 조회합니다. (종료일 오름차순 정렬)
    tags: [Challenge]
    security:
      - bearerAuth: []
    responses:
      '200':
        description: 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                resultType:
                  type: string
                  example: SUCCESS
                  description: 응답 결과 타입 (항상 'SUCCESS')
                error:
                  type: string
                  nullable: true
                  example: null
                  description: 에러 메시지 (정상 응답 시 null)
                success:
                  type: array
                  description: 유효한 챌린지 목록
                  items:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      title:
                        type: string
                        example: 친구와 함께하는 카공 챌린지
                      description:
                        type: string
                        example: 혼자보다 함께일 때 더 집중돼요!
                      thumbnailUrl:
                        type: string
                        example: https://cdn.loopy.com/challenges/1.jpg
                      startDate:
                        type: string
                        format: date
                        example: 2025-08-01
                      endDate:
                        type: string
                        format: date
                        example: 2025-08-30
                      isParticipated:
                        type: boolean
                        example: true

  /api/v1/challenges/{challengeId}:
  get:
    summary: 챌린지 상세 조회
    description: 챌린지 ID로 상세 정보를 조회합니다.
    tags: [Challenge]
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: challengeId
        required: true
        schema:
          type: integer
    responses:
      '200':
        description: 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                resultType:
                  type: string
                  example: SUCCESS
                  description: 응답 결과 상태
                error:
                  type: string
                  nullable: true
                  example: null
                  description: 에러 메시지 (정상 응답 시 null)
                success:
                  type: object
                  description: 챌린지 상세 정보
                  properties:
                    id:
                      type: integer
                      example: 1
                    title:
                      type: string
                      example: 친구와 함께하는 카공 챌린지
                    description:
                      type: string
                      example: 친구와 함께 카페에서 공부하며 인증하는 루피 챌린지입니다.
                    thumbnailUrl:
                      type: string
                      example: https://cdn.loopy.com/challenges/1.jpg
                    startDate:
                      type: string
                      format: date
                      example: 2025-08-01
                    endDate:
                      type: string
                      format: date
                      example: 2025-08-30
                    goalDescription:
                      type: string
                      example: 카페에서 공부 인증 3회
                    goalCount:
                      type: integer
                      example: 3
                    rewardPoint:
                      type: integer
                      example: 300
                    isParticipated:
                      type: boolean
                      example: true
                    joinedCafe:
                      type: object
                      nullable: true
                      description: 유저가 참여 중일 경우, 선택한 매장 정보
                      properties:
                        id:
                          type: integer
                          example: 12
                        name:
                          type: string
                          example: 카페 위니
                    availableCafes:
                      type: array
                      description: 챌린지 참여 가능한 카페 목록
                      items:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 12
                          name:
                            type: string
                            example: 카페 위니
                          address:
                            type: string
                            example: 서울 서대문구 이화여대길 52
                          image:
                            type: string
                            example: https://cdn.loopy.com/cafes/12.jpg
                          region1DepthName:
                            type: string
                            example: 서울특별시
                          region2DepthName:
                            type: string
                            example: 서대문구
                          region3DepthName:
                            type: string
                            example: 이화동

  /api/v1/challenges/{challengeId}/join:
  post:
    summary: 챌린지 참여
    description: 해당 챌린지에 로그인 유저가 참여합니다. 참여 시 선택한 매장 ID를 함께 전달해야 합니다.
    tags: [Challenge]
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: challengeId
        required: true
        schema:
          type: integer
        description: 참여할 챌린지의 ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - joinedCafeId
            properties:
              joinedCafeId:
                type: integer
                example: 12
                description: 유저가 선택한 참여 매장의 ID
    responses:
      '200':
        description: 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                resultType:
                  type: string
                  example: SUCCESS
                error:
                  type: string
                  nullable: true
                  example: null
                success:
                  type: object
                  properties:
                    message:
                      type: string
                      example: 챌린지 참여가 완료되었습니다.

  /api/v1/challenges/{challengeId}/cafes:
  get:
    summary: 참여 가능 매장 조회
    description: 특정 챌린지에 참여 가능한 카페 목록을 반환합니다. 카페는 '운영 중(active)' 상태인 것만 포함됩니다.
    tags: [Challenge]
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: challengeId
        required: true
        schema:
          type: integer
        description: 대상 챌린지의 ID
    responses:
      '200':
        description: 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                resultType:
                  type: string
                  example: SUCCESS
                error:
                  type: string
                  nullable: true
                  example: null
                success:
                  type: array
                  description: 참여 가능한 카페 목록
                  items:
                    type: object
                    properties:
                      cafeId:
                        type: integer
                        example: 12
                        description: 카페 ID
                      name:
                        type: string
                        example: 카페 위니
                        description: 카페 이름
                      address:
                        type: string
                        example: 서울 서대문구 이화여대길 52
                      region1DepthName:
                        type: string
                        example: 서울특별시
                        description: 시/도
                      region2DepthName:
                        type: string
                        example: 서대문구
                        description: 구/군
                      region3DepthName:
                        type: string
                        example: 이화동
                        description: 동/읍/면
                      distance:
                        type: number
                        example: 500
                        description: 거리 (단위: 미터, 추후 위치 기반 계산 적용 예정)

  /api/v1/users/me/challenges:
  get:
    summary: 나의 챌린지 목록 조회
    description: 로그인 유저가 현재 참여 중인 챌린지 목록을 조회합니다. (진행 중 상태만 반환)
    tags: [Challenge]
    security:
      - bearerAuth: []
    responses:
      '200':
        description: 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                resultType:
                  type: string
                  example: SUCCESS
                error:
                  type: string
                  nullable: true
                  example: null
                success:
                  type: array
                  description: 유저가 현재 참여 중인 챌린지 리스트
                  items:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 3
                        description: 챌린지 ID
                      title:
                        type: string
                        example: 환경 보호 챌린지
                        description: 챌린지 제목
                      thumbnailUrl:
                        type: string
                        example: https://cdn.loopy.com/challenges/3.jpg
                        description: 챌린지 썸네일 이미지 URL
                      tag:
                        type: string
                        nullable: true
                        example: ECO
                        description: 챌린지 태그 (nullable)
                      startDate:
                        type: string
                        format: date
                        example: 2025-08-01
                        description: 챌린지 시작일
                      endDate:
                        type: string
                        format: date
                        example: 2025-08-31
                        description: 챌린지 종료일

  /api/v1/challenges/{challengeId}/complete:
    post:
      summary: 챌린지 완료 처리
      description: 챌린지를 완료 처리하고 쿠폰을 발급합니다.
      tags: [Challenge]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: challengeId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  resultType: { type: string }
                  error: { type: string, nullable: true }
                  success:
                    type: object
                    properties:
                      message: { type: string }
                      couponId: { type: integer, nullable: true }

  /api/v1/users/me/stampbooks:
    get:
      summary: 전체 스탬프북 조회
      description: 로그인한 사용자의 전체 스탬프북을 정렬 기준에 따라 조회
      tags:
        - Stamp
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [mostStamped, shortestDeadline]
          description: 정렬 기준 (적립 많은 순 or 기한 짧은 순). 기본값: 생성일 내림차순
      responses:
        '200':
          description: 스탬프북 리스트 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampBookListResponse'

  /api/v1/stampbooks/{stampBookId}:
    get:
      summary: 스탬프북 상세 조회
      description: 특정 스탬프북의 상세 정보를 조회
      tags:
        - Stamp
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: stampBookId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 스탬프북 상세 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampBookDetail'
        '403':
          description: 접근 권한 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

        '404':
          description: 리소스를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/stampbooks/{stampBookId}/stamps:
    post:
      summary: 도장 적립
      description: 스탬프북에 도장 1개 적립 (QR or 수동 방식)
      tags:
        - Stamp
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: stampBookId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cafeId:
                  type: integer
                method:
                  type: string
                  enum: [QR, MANUAL]
      responses:
        '200':
          description: 도장 적립 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  stampCount:
                    type: integer
                  isStampbookCompleted:
                    type: boolean

  /api/v1/stampbooks/{stampBookId}/convert:
  post:
    summary: 스탬프 → 포인트 환전
    description: 완료된 스탬프북을 포인트로 환전합니다. <br> 완료되지 않았거나 이미 환전된 스탬프북일 경우 에러가 발생합니다.
    tags:
      - Stamp
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: stampBookId
        required: true
        schema:
          type: integer
    responses:
      '200':
        description: 환전 성공
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampConversionSuccessResponse'
      '400':
        description: 잘못된 요청 (예: 완료되지 않은 스탬프북, 환전 불가능 상태)
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      '403':
        description: 접근 권한 없음
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      '404':
        description: 스탬프북을 찾을 수 없음
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'


    # delete:
    #   summary: 환전 취소
    #   description: 환전 후 3일 이내 환전 취소
    #   tags:
    #     - Stamp
    #   security:
    #     - bearerAuth: []
    #   parameters:
    #     - in: path
    #       name: stampBookId
    #       required: true
    #       schema:
    #         type: integer
    #   responses:
    #     '200':
    #       description: 환전 취소 성공
    #       content:
    #         application/json:
    #           schema:
    #             type: object
    #             properties:
    #               message:
    #                 type: string
    #               refundPoint:
    #                 type: integer

  /api/v1/stampbooks/{stampBookId}/extend:
  patch:
    summary: 스탬프북 기간 연장
    description: 진행 중인(active) 스탬프북의 만료일을 1회에 한해 14일 연장합니다. 이미 연장된 경우 또는 완료된 스탬프북은 연장할 수 없습니다.
    tags:
      - Stamp
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: stampBookId
        required: true
        schema:
          type: integer
    responses:
      '200':
        description: 연장 성공
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampBookExtensionSuccessResponse'
      '400':
        description: 잘못된 요청 (예: 이미 연장된 스탬프북)
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      '403':
        description: 접근 권한 없음
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
      '404':
        description: 스탬프북을 찾을 수 없음
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/stampbooks/expiring:
    get:
      summary: 소멸 임박 스탬프북 조회
      description: 7일 이내 만료 예정인 active 스탬프북 목록 조회
      tags:
        - Stamp
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StampBookExpiring'

  /api/v1/users/me/stampbooks/converted:
    get:
      summary: 환전 완료된 스탬프북 히스토리 조회
      description: 사용자가 환전한 스탬프북 목록을 조회합니다. 최근 환전된 순으로 정렬되며, 각 스탬프북의 회차와 환전 일자를 포함합니다.
      tags:
        - Stamp
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 환전 히스토리 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConvertedStampBookHistoryResponse'
        '500':
          description: 서버 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/stamps/count:
    get:
    summary: 총 스탬프 수 조회
    description: 로그인한 사용자가 보유한 전체 스탬프 개수를 반환합니다. 모든 스탬프북에 적립된 도장의 수를 합산한 값입니다.
    tags:
      - Stamp
    security:
      - bearerAuth: []
    responses:
      '200':
        description: 총 스탬프 수 조회 성공
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TotalStampCountResponse'
      '500':
        description: 서버 오류
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'

  /api/v1/users/me/loopy-level:
    get:
      summary: 루피 레벨 조회
      description: 사용자가 보유한 스탬프북 개수에 따라 루피 레벨을 계산합니다.
      tags:
        - Stamp
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 루피 레벨 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoopyLevelResponse'
        '500':
          description: 서버 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  
  /api/v1/notification/{notificationId}:
    get:
      tags:
        - Notifications
      summary: 알림 상세 조회
      description: 알림 ID를 기반으로 상세 정보를 조회합니다. 읽지 않은 알림이라면 읽음 처리됩니다.
      security:
        - bearerAuth: []
      parameters:
        - name: notificationId
          in: path
          required: true
          description: 조회할 알림 ID
          schema:
            type: integer
      responses:
        '200':
          description: 알림 상세 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 알림 상세 조회 성공
                  data:
                    type: object
                    properties:
                      notificationId:
                        type: integer
                        example: 12
                      title:
                        type: string
                        example: 오늘의 챌린지가 시작됐어요!
                      type:
                        type: string
                        enum: [system, challenge, stamp, review, coupon]
                      createdAt:
                        type: string
                        format: date-time
                      cafe:
                        type: object
                        nullable: true
                        properties:
                          id:
                            type: integer
                            example: 1
                          name:
                            type: string
                            example: 루피커피
                      detail:
                        oneOf:
                          - $ref: '#/components/schemas/SystemNotificationDetail'
                          - $ref: '#/components/schemas/ChallengeNotificationDetail'
                          - $ref: '#/components/schemas/StampNotificationDetail'
                          - $ref: '#/components/schemas/ReviewNotificationDetail'
                          - $ref: '#/components/schemas/CouponNotificationDetail'
        '404':
          description: 알림이 존재하지 않음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/stampbooks/{cafeId}/coupon:
    post:
      tags:
        - StampBooks
      summary: 스탬프 목표 달성 시 리워드 쿠폰 발급
      description: 스탬프북의 목표를 달성한 경우, 사용자에게 리워드 쿠폰을 발급합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: cafeId
          in: path
          required: true
          description: 쿠폰을 발급받을 카페 ID
          schema:
            type: integer
      responses:
        '200':
          description: 리워드 쿠폰 발급 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 리워드 쿠폰 발급 성공
                  coupon:
                    $ref: '#/components/schemas/UserCoupon'
        '400':
          description: 스탬프북이 조건을 만족하지 않음 또는 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증되지 않은 사용자
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 스탬프북 또는 카페를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/cafe/{cafeId}/review:
  post:
    tags:
      - Review
    summary: 리뷰 작성
    description: 제목 20자 이상, 본문 500자 이상, 이미지 최대 5장까지 첨부 가능합니다.
    security:
      - bearerAuth: []
    parameters:
      - name: cafeId
        in: path
        required: true
        schema:
          type: integer
        description: 리뷰를 작성할 카페 ID
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            required:
              - title
              - content
            properties:
              title:
                type: string
                example: "카페 분위기가 너무 좋아요!"
              content:
                type: string
                example: >
                  커피 맛도 좋고 조용해서 공부하기 좋았어요. 다음에 또 방문할 예정입니다.
              images:
                type: array
                items:
                  type: string
                  format: binary
                description: 첨부 이미지 파일 (최대 5장)
    responses:
      '201':
        description: 리뷰 작성 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 리뷰 작성 성공
                review:
                  $ref: '#/components/schemas/Review'
      '400':
        description: 잘못된 요청 (제목/본문 미입력, 유효성 실패 등)
        content:
          application/json:
            examples:
              제목 짧음:
                value: { errorCode: "R001", reason: "제목은 최소 20자 이상이어야 합니다." }
              본문 짧음:
                value: { errorCode: "R002", reason: "본문은 최소 500자 이상이어야 합니다." }
              필드 누락:
                value: { errorCode: "R005", reason: "제목과 본문을 모두 입력해주세요." }
              이미지 타입 오류:
                value: { errorCode: "R006", reason: "이미지 파일 형식만 업로드할 수 있습니다. (받은 타입: text/plain)" }
              이미지 수량 초과:
                value: { errorCode: "R007", reason: "이미지는 최대 5개까지만 업로드할 수 있습니다. (받은 수량: 6개)" }
      '403':
        description: 유효한 스탬프가 없음
        content:
          application/json:
            example:
              value: { errorCode: "R008", reason: "스탬프 적립을 시작하고 리뷰를 작성해보세요!" }
      '500':
        description: 서버 오류

  /api/v1/reviews/{reviewId}:
  patch:
    tags:
      - Review
    summary: 리뷰 수정
    description: 본인의 리뷰만 수정할 수 있습니다.
    security:
      - bearerAuth: []
    parameters:
      - name: reviewId
        in: path
        required: true
        schema:
          type: integer
        description: 수정할 리뷰 ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - title
              - content
            properties:
              title:
                type: string
                example: "업데이트된 제목입니다."
              content:
                type: string
                example: "내용도 새롭게 작성했습니다."
    responses:
      '200':
        description: 리뷰 수정 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 리뷰 수정 성공
                review:
                  $ref: '#/components/schemas/Review'
      '403':
        description: 권한 없음
        content:
          application/json:
            example:
              value: { errorCode: "R004", reason: "본인의 리뷰만 수정/삭제할 수 있습니다." }
      '404':
        description: 리뷰 없음
        content:
          application/json:
            example:
              value: { errorCode: "R003", reason: "ID 123에 해당하는 리뷰가 존재하지 않습니다." }
      '400':
        description: 필수 필드 누락
        content:
          application/json:
            example:
              value: { errorCode: "R005", reason: "제목과 본문을 모두 입력해주세요." }
      '500':
        description: 서버 오류

  delete:
    tags:
      - Review
    summary: 리뷰 삭제
    description: 본인이 작성한 리뷰만 삭제할 수 있습니다.
    security:
      - bearerAuth: []
    parameters:
      - name: reviewId
        in: path
        required: true
        schema:
          type: integer
        description: 삭제할 리뷰 ID
    responses:
      '200':
        description: 리뷰 삭제 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 리뷰 삭제 성공!
      '403':
        description: 권한 없음
        content:
          application/json:
            example:
              value: { errorCode: "R004", reason: "본인의 리뷰만 수정/삭제할 수 있습니다." }
      '404':
        description: 리뷰 없음
        content:
          application/json:
            example:
              value: { errorCode: "R003", reason: "ID 123에 해당하는 리뷰가 존재하지 않습니다." }
      '500':
        description: 서버 오류

  /api/v1/users/me/reviews:
  get:
    tags:
      - Review
    summary: 내가 작성한 리뷰 목록 조회
    description: 로그인한 사용자가 작성한 리뷰 목록을 페이지네이션 형식으로 조회합니다.
    security:
      - bearerAuth: []
    parameters:
      - name: page
        in: query
        required: false
        schema:
          type: integer
          default: 1
        description: 조회할 페이지 번호
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          default: 10
        description: 페이지당 항목 수
    responses:
      '200':
        description: 내가 쓴 리뷰 목록 조회 성공
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 내가 쓴 리뷰 목록 조회 성공
                data:
                  type: array
                  items:
                    $ref: '#/components/schemas/UserReviewSummary'
                pagination:
                  type: object
                  properties:
                    page:
                      type: integer
                      example: 1
                    limit:
                      type: integer
                      example: 10
                    total:
                      type: integer
                      example: 27
      '401':
        description: 인증 실패
        content:
          application/json:
            example:
              value: { errorCode: "AUTH001", reason: "JWT 토큰이 유효하지 않습니다." }
      '500':
        description: 서버 오류

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    UserProfile:
      type: object
      properties:
        id:
          type: string
          example: "2"
        email:
          type: string
          example: test@example.com
        phoneNumber:
          type: string
          example: "01012345678"
        nickname:
          type: string
          example: 테스터
        role:
          type: string
          enum: [CUSTOMER, OWNER]
          example: CUSTOMER
        status:
          type: string
          enum: [active, inactive]
          example: active
        allowKakaoAlert:
          type: boolean
          example: false
        profileImageUrl:
          type: string
          nullable: true
          example: null
        fcmToken:
          type: string
          nullable: true
          example: null
        createdAt:
          type: string
          format: date-time
          example: "2025-07-01T10:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-07-17T16:30:00.000Z"
        inactivedAt:
          type: string
          format: date-time
          nullable: true
          example: null
  
    LoginUserProfile:
      type: object
      properties:
        id:
          type: string
          example: "1"
        email:
          type: string
          example: test@example.com
        nickname:
          type: string
          example: 테스터
        currentRole:
          type: string
          enum: [CUSTOMER, OWNER]
          example: CUSTOMER


    UserAgreementRequest:
      type: object
      required:
        - termsAgreed
        - privacyPolicyAgreed
        - marketingAgreed
        - locationPermission
      properties:
        termsAgreed:
          type: boolean
          example: true
        privacyPolicyAgreed:
          type: boolean
          example: true
        marketingAgreed:
          type: boolean
          example: false
        locationPermission:
          type: boolean
          example: true

    UserKeywordPreferenceRequest:
      type: object
      required:
        - preferredKeywords
      properties:
        preferredKeywords:
          type: array
          items:
            type: string
          description: 사용자가 선택한 키워드 문자열 목록
          example:
            - 1인석
            - 노트북
            - 디카페인
            - 텀블러 할인

    UserAgreementResponse:
      type: object
      properties:
        id:
          type: string
          example: "1"
        userId:
          type: string
          example: "1"
        termsAgreed:
          type: boolean
          example: true
        privacyPolicyAgreed:
          type: boolean
          example: true
        marketingAgreed:
          type: boolean
          example: false
        locationPermission:
          type: boolean
          example: true
        agreedAt:
          type: string
          format: date-time
          example: "2025-07-23T04:40:50.464Z"

    UserPreferredAreaRequest:
      type: object
      required:
        - preferredArea
      properties:
        preferredArea:
          type: string
          example: 서울 마포구 신촌동

    KakaoAlertSettingRequest:
      type: object
      required:
        - allowKakaoAlert
      properties:
        allowKakaoAlert:
          type: boolean
          example: true

    BookmarkedCafe:
      type: object
      properties:
        id:
          type: string
          example: "1"
        name:
          type: string
          example: 테스트카페
        address:
          type: string
          example: 서울시 마포구 양화로 123
        region:
          type: string
          example: 마포구
        latitude:
          type: number
          example: 37.5509
        longitude:
          type: number
          example: 126.9143
        description:
          type: string
          nullable: true
          example: null
        keywords:
          type: array
          nullable: true
          items:
            type: string
          example: null
        status:
          type: string
          enum: [active, inactive, deleted]
          example: active
        createdAt:
          type: string
          format: date-time
          example: "2025-07-19T09:21:39.933Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-07-19T09:20:09.040Z"
    
    CafeSearchResponse:
      type: object
      required:
        - resultType
        - error
        - success
      properties:
        resultType:
          type: string
          enum: [SUCCESS, ERROR]
          description: 응답 결과 타입
        error:
          type: object
          nullable: true
          description: 에러 정보 (성공시 null)
        success:
          $ref: '#/components/schemas/CafeSearchInfo'
          nullable: true
          description: 카페 정보 (실패시 null)

    CafeSearchErrorResponse:
      type: object
      required:
        - resultType
        - error
        - success
      properties:
        resultType:
          type: string
          enum: [ERROR]
          description: 응답 결과 타입
        error:
          $ref: '#/components/schemas/CafeSearchErrorInfo'
          description: 에러 정보
        success:
          type: object
          nullable: true
          description: 성공 데이터 (에러시 null)

    CafeSearchErrorInfo:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: 에러 코드
          example: "INVALID_PARAMETER"
        message:
          type: string
          description: 에러 메시지
          example: "유효하지 않은 파라미터입니다"

    CafeSearchInfo:
      type: object
      required:
        - id
        - name
        - keywords
        - photos
        - distance
      properties:
        id:
          type: string
          description: 카페 고유 ID
          example: "1"
        name:
          type: string
          description: 카페 이름
          example: "로스터리 카페"
        keywords:
          type: array
          items:
            type: string
          description: 카페 키워드 목록
          example: ["커피", "로스팅"]
        photos:
          type: array
          items:
            $ref: '#/components/schemas/CafeSearchPhoto'
          description: 카페 사진 목록
        distance:
          type: integer
          description: 현재 위치에서 카페까지의 거리 (미터)
          example: 100

    CafeSearchPhoto:
      type: object
      required:
        - id
        - url
        - displayOrder
      properties:
        id:
          type: string
          description: 사진 고유 ID
          example: "1"
        url:
          type: string
          format: uri
          description: 사진 URL
          example: "https://example.com/photos/roastery-exterior.jpg"
        displayOrder:
          type: integer
          description: 사진 표시 순서
          example: 1
          minimum: 1

    CafeMapSearchResponse:
      type: object
      required:
        - resultType
        - error
        - success
      properties:
        resultType:
          type: string
          enum: [SUCCESS, ERROR]
          description: 응답 결과 타입
        error:
          type: object
          nullable: true
          description: 에러 정보 (성공시 null)
        success:
          $ref: '#/components/schemas/CafeMapSearchResult'
          nullable: true
          description: 검색 결과 (실패시 null)

    CafeMapSearchErrorResponse:
      type: object
      required:
        - resultType
        - error
        - success
      properties:
        resultType:
          type: string
          enum: [ERROR]
          description: 응답 결과 타입
        error:
          $ref: '#/components/schemas/CafeMapSearchErrorInfo'
          description: 에러 정보
        success:
          type: object
          nullable: true
          description: 성공 데이터 (에러시 null)

    CafeMapSearchErrorInfo:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: 에러 코드
          example: "INVALID_PARAMETER"
        message:
          type: string
          description: 에러 메시지
          example: "유효하지 않은 파라미터입니다"

    CafeMapSearchResult:
      type: object
      required:
        - cafes
        - totalCount
        - searchRadius
        - zoomLevel
        - center
      properties:
        cafes:
          type: array
          items:
            $ref: '#/components/schemas/CafeMapSearchItem'
          description: 검색된 카페 목록
        totalCount:
          type: integer
          description: 총 검색된 카페 수
          example: 3
        searchRadius:
          type: integer
          description: 검색 반경 (미터)
          example: 320
        zoomLevel:
          type: string
          description: 지도 줌 레벨
          example: "3"
        center:
          $ref: '#/components/schemas/CafeMapSearchCenter'
          description: 검색 중심점 좌표

    CafeMapSearchItem:
      type: object
      required:
        - id
        - name
        - latitude
        - longitude
        - isBookmarked
      properties:
        id:
          type: integer
          description: 카페 고유 ID
          example: 10
        name:
          type: string
          description: 카페 이름
          example: "스타벅스 강남역점"
        latitude:
          type: number
          format: double
          description: 위도
          example: 37.497175
        longitude:
          type: number
          format: double
          description: 경도
          example: 127.027926
        isBookmarked:
          type: boolean
          description: 북마크 여부
          example: false

    CafeMapSearchCenter:
      type: object
      required:
        - x
        - y
      properties:
        x:
          type: number
          format: double
          description: 중심점 X 좌표 (경도)
          example: 127.027926
        y:
          type: number
          format: double
          description: 중심점 Y 좌표 (위도)
          example: 37.497175

    CafeDetailResponse:
      type: object
      required:
        - resultType
        - error
        - success
      properties:
        resultType:
          type: string
          enum: [SUCCESS, ERROR]
          description: 응답 결과 타입
        error:
          type: object
          nullable: true
          description: 에러 정보 (성공시 null)
        success:
          $ref: '#/components/schemas/CafeDetailResult'
          nullable: true
          description: 카페 상세 정보 (실패시 null)

    CafeDetailErrorResponse:
      type: object
      required:
        - resultType
        - error
        - success
      properties:
        resultType:
          type: string
          enum: [ERROR]
          description: 응답 결과 타입
        error:
          $ref: '#/components/schemas/CafeDetailErrorInfo'
          description: 에러 정보
        success:
          type: object
          nullable: true
          description: 성공 데이터 (에러시 null)

    CafeDetailErrorInfo:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: 에러 코드
          example: "UNAUTHORIZED"
        message:
          type: string
          description: 에러 메시지
          example: "유효하지 않은 토큰입니다"

    CafeDetailResult:
      type: object
      required:
        - cafe
        - photos
        - menu
        - coupons
        - stampBook
        - bookmark
      properties:
        cafe:
          $ref: '#/components/schemas/CafeDetailInfo'
        photos:
          type: array
          items:
            $ref: '#/components/schemas/CafeDetailPhoto'
          description: 카페 사진 목록
        menu:
          type: array
          items:
            $ref: '#/components/schemas/CafeDetailMenuItem'
          description: 메뉴 목록
        coupons:
          type: array
          items:
            $ref: '#/components/schemas/CafeDetailCoupon'
          description: 쿠폰 목록
        stampBook:
          $ref: '#/components/schemas/CafeDetailStampBook'
          description: 스탬프북 정보
        bookmark:
          $ref: '#/components/schemas/CafeDetailBookmark'
          description: 북마크 정보

    CafeDetailInfo:
      type: object
      required:
        - id
        - name
        - address
        - businessHours
        - phone
        - websiteUrl
        - description
        - storeFilters
        - takeOutFilters
        - menuFilters
        - keywords
      properties:
        id:
          type: integer
          description: 카페 고유 ID
          example: 1
        name:
          type: string
          description: 카페 이름
          example: "로스터리 카페"
        address:
          type: string
          description: 카페 주소
          example: "서울시 강남구 테헤란로 123"
        businessHours:
          type: array
          items:
            $ref: '#/components/schemas/CafeDetailBusinessHour'
          description: 영업시간 정보
        phone:
          type: string
          description: 전화번호
          example: "02-1234-5678"
        websiteUrl:
          type: string
          format: uri
          description: 웹사이트 URL
          example: "https://roastery-cafe.com"
        description:
          type: string
          description: 카페 설명
          example: "신선한 원두를 직접 로스팅하는 스페셜티 커피 전문점입니다."
        storeFilters:
          type: object
          additionalProperties:
            type: boolean
          description: 매장 필터 정보
          example:
            "1인석": true
            "단체석": false
            "노트북석": true
        takeOutFilters:
          type: object
          additionalProperties:
            type: boolean
          description: 테이크아웃 필터 정보
          example:
            "포장 할인": false
            "텀블러 할인": true
        menuFilters:
          type: object
          additionalProperties:
            type: boolean
          description: 메뉴 필터 정보
          example:
            "비건": false
            "디카페인": true
        keywords:
          type: array
          items:
            type: string
          description: 카페 키워드
          example: ["커피", "로스팅"]

    CafeDetailBusinessHour:
      type: object
      required:
        - day
        - isClosed
      properties:
        day:
          type: string
          enum: [MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY]
          description: 요일
          example: "MONDAY"
        isClosed:
          type: boolean
          description: 휴무 여부
          example: false
        openTime:
          type: string
          description: 오픈 시간
          example: "09:00"
        closeTime:
          type: string
          description: 마감 시간
          example: "21:00"
        breakStart:
          type: string
          description: 브레이크 타임 시작
          example: "14:00"
        breakEnd:
          type: string
          description: 브레이크 타임 종료
          example: "15:00"

    CafeDetailPhoto:
      type: object
      required:
        - id
        - url
        - displayOrder
      properties:
        id:
          type: integer
          description: 사진 ID
          example: 1
        url:
          type: string
          format: uri
          description: 사진 URL
          example: "https://example.com/photos/roastery-exterior.jpg"
        displayOrder:
          type: integer
          description: 표시 순서
          example: 1

    CafeDetailMenuItem:
      type: object
      required:
        - id
        - name
        - price
        - description
        - imgUrl
        - isSoldOut
      properties:
        id:
          type: integer
          description: 메뉴 ID
          example: 1
        name:
          type: string
          description: 메뉴 이름
          example: "시그니처 아메리카노"
        price:
          type: integer
          description: 가격
          example: 4500
        description:
          type: string
          description: 메뉴 설명
          example: "하우스 블렌드 원두로 추출한 깔끔한 아메리카노"
        imgUrl:
          type: string
          format: uri
          description: 메뉴 이미지 URL
          example: "https://example.com/menu/signature-americano.jpg"
        isSoldOut:
          type: boolean
          description: 품절 여부
          example: false

    CafeDetailCoupon:
      type: object
      required:
        - id
        - name
        - validDays
        - discountType
        - discountValue
        - applicableMenu
        - expiredAt
      properties:
        id:
          type: integer
          description: 쿠폰 ID
          example: 1
        name:
          type: string
          description: 쿠폰 이름
          example: "시그니처 아메리카노 무료"
        validDays:
          type: integer
          description: 유효 기간 (일)
          example: 30
        discountType:
          type: string
          enum: [fixed, percentage]
          description: 할인 타입
          example: "fixed"
        discountValue:
          type: number
          description: 할인 값
          example: 4500
        applicableMenu:
          type: object
          nullable: true
          description: 적용 가능 메뉴
          example: null
        expiredAt:
          type: string
          format: date-time
          description: 만료일시
          example: "2025-12-31T23:59:59.000Z"

    CafeDetailStampBook:
      type: object
      required:
        - id
        - currentCount
        - goalCount
        - expiresAt
        - stampBookId
      properties:
        id:
          type: integer
          description: 스탬프북 ID
          example: 1
        currentCount:
          type: integer
          description: 현재 스탬프 개수
          example: 3
        goalCount:
          type: integer
          description: 목표 스탬프 개수
          example: 10
        expiresAt:
          type: string
          format: date-time
          description: 만료일시
          example: "2025-12-31T23:59:59.000Z"
        stampBookId:
          type: integer
          description: 스탬프북 ID
          example: 1

    CafeDetailBookmark:
      type: object
      required:
        - isBookmarked
      properties:
        isBookmarked:
          type: boolean
          description: 북마크 여부
          example: false

    ErrorResponse:
      type: object
      properties:
        errorCode:
          type: string
          description: 에러 코드 식별자
          example: U001
        reason:
          type: string
          description: 사용자에게 보여줄 에러 메시지
          example: 잘못된 요청입니다.
        data:
          type: object
          nullable: true
          description: 추가적인 에러 관련 데이터
          example: null

    RegisterRequest:
      type: object
      required:
        - email
        - password
        - nickname
        - phoneNumber
        - role
        - allowKakaoAlert
        - agreements
      properties:
        email:
          type: string
          format: email
          default: test@example.com
        password:
          type: string
          format: password
          default: securepassword123
        nickname:
          type: string
          default: 테스터
        phoneNumber:
          type: string
          default: "01012345678"
        role:
          type: string
          enum: [CUSTOMER, OWNER]
          default: CUSTOMER
        allowKakaoAlert:
          type: boolean
          default: true
        agreements:
          type: object
          required:
            - termsAgreed
            - privacyPolicyAgreed
            - marketingAgreed
            - locationPermission
          properties:
            termsAgreed:
              type: boolean
              default: true
            privacyPolicyAgreed:
              type: boolean
              default: true
            marketingAgreed:
              type: boolean
              default: false
            locationPermission:
              type: boolean
              default: true

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: test@example.com
        password:
          type: string
          format: password
          example: securepassword123
        role:
          type: string
          enum: [CUSTOMER, OWNER]
          example: CUSTOMER

    FcmTokenRequest:
      type: object
      required:
        - fcmToken
      properties:
        fcmToken:
          type: string
          example: abc123xyz456

    PhoneVerificationRequest:
      type: object
      required:
        - idToken
        - userId
      properties:
        idToken:
          type: string
          description: Firebase에서 발급받은 ID 토큰
        userId:
          type: integer
          description: 백엔드에서 생성된 사용자 ID
    
    NicknameUpdateRequest:
      type: object
      required:
        - nickname
      properties:
        nickname:
          type: string
          example: 새로운닉네임

    BookmarkRequest:
      type: object
      required:
        - cafeId
      properties:
        cafeId:
          type: integer
          example: 1

    ChallengeListItem:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        thumbnailUrl:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        isParticipated:
          type: boolean

    ChallengeListResponse:
      type: array
      items:
        $ref: '#/components/schemas/ChallengeListItem'

    ChallengeAvailableCafe:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        address:
          type: string
        region1DepthName:
          type: string
        region2DepthName:
          type: string
        region3DepthName:
          type: string

    ChallengeDetail:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        thumbnailUrl:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        goalDescription:
          type: string
        goalCount:
          type: integer
        rewardPoint:
          type: integer
        isParticipated:
          type: boolean
        availableCafes:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeAvailableCafe'

    MyChallengeListItem:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        thumbnailUrl:
          type: string
        tag:
          type: string
          nullable: true
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date

    MyChallengeListResponse:
      type: array
      items:
        $ref: '#/components/schemas/MyChallengeListItem'

    StampBookListItem:
      type: object
      properties:
        id:
          type: integer
        cafe:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            address:
              type: string
            image:
              type: string
              example: https://cdn.loopy.com/cafes/3.jpg
        currentCount:
          type: integer
        goalCount:
          type: integer
        status:
          type: string
        expiredAt:
          type: string
          format: date-time


    StampBookListSuccessResponse:
      type: object
      properties:
        status:
          type: string
          example: SUCCESS
        code:
          type: integer
          example: 200
        message:
          type: string
          example: 스탬프북 리스트 조회 성공
        data:
          $ref: '#/components/schemas/StampBookListResponse'


    Stamp:
      type: object
      properties:
        id:
          type: integer
          example: 12
        stampedAt:
          type: string
          format: date-time
          example: "2025-07-31T08:15:30.000Z"
        stampImageUrl:
          type: string
          nullable: true
          example: "https://cdn.loopy.com/stamps/12.png"
        source:
          type: string
          example: "QR"
        note:
          type: string
          nullable: true
          example: "QR 인식이 잘 안됐어요"
        latitude:
          type: number
          format: float
          nullable: true
          example: 37.5656
        longitude:
          type: number
          format: float
          nullable: true
          example: 126.9784


    StampBookDetail:
      type: object
      properties:
        id:
          type: integer
        cafe:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            address:
              type: string
        goalCount:
          type: integer
        currentCount:
          type: integer
        status:
          type: string
        isCompleted:
          type: boolean
        rewardDetail:
          type: string
        startedAt:
          type: string
          format: date-time
        lastVisitedAt:
          type: string
          format: date-time
          nullable: true
        expiresAt:
          type: string
          format: date-time
        extendedAt:
          type: string
          format: date-time
          nullable: true
        expiredAt:
          type: string
          format: date-time
          nullable: true
        completedAt:
          type: string
          format: date-time
          nullable: true
        convertedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        stamps:
          type: array
          items:
            $ref: '#/components/schemas/Stamp'
        isExpiringSoon:
          type: boolean
          example: true
        isExpired:
          type: boolean
          example: false
        daysUntilExpiration:
          type: integer
          example: 2

    StampBookExpiring:
      type: object
      properties:
        id:
          type: integer
        cafe:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            address:
              type: string
        expiresAt:
          type: string
          format: date-time
        status:
          type: string

    StampConversionResult:
      type: object
      properties:
        stampCount:
          type: integer
          example: 5
        pointAmount:
          type: integer
          example: 500
        convertedAt:
          type: string
          format: date-time
          example: "2025-07-31T09:10:30.000Z"

    StampConversionSuccessResponse:
      type: object
      properties:
        status:
          type: string
          example: SUCCESS
        code:
          type: integer
          example: 200
        message:
          type: string
          example: 5개의 스탬프가 10포인트로 환전되었습니다.
        data:
          $ref: '#/components/schemas/StampConversionResult'

    ConvertedStampBookHistoryItem:
      type: object
      properties:
        stampBookId:
          type: integer
          example: 15
        cafeName:
          type: string
          example: 블루보틀 연남점
        address:
          type: string
          example: 서울특별시 마포구 연남동 123-45
        round:
          type: integer
          example: 3
        convertedAt:
          type: string
          format: date-time
          example: "2025-07-31T13:45:00.000Z"

    ConvertedStampBookHistoryResponse:
      type: object
      properties:
        status:
          type: string
          example: SUCCESS
        code:
          type: integer
          example: 200
        message:
          type: string
          example: 스탬프 히스토리 조회 성공
        data:
          type: array
          items:
            $ref: '#/components/schemas/ConvertedStampBookHistoryItem'
      
    TotalStampCountResult:
      type: object
      properties:
        totalStampCount:
          type: integer
          example: 42

    TotalStampCountResponse:
      type: object
      properties:
        status:
          type: string
          example: SUCCESS
        code:
          type: integer
          example: 200
        message:
          type: string
          example: 총 스탬프 수 조회 성공
        data:
          $ref: '#/components/schemas/TotalStampCountResult'

    LoopyLevelResult:
      type: object
      properties:
        stampBookCount:
          type: integer
          example: 8
        level:
          type: integer
          example: 2
        label:
          type: string
          example: 차곡차곡 쌓는 수집가

    LoopyLevelResponse:
      type: object
      properties:
        status:
          type: string
          example: SUCCESS
        code:
          type: integer
          example: 200
        message:
          type: string
          example: 루피 레벨 조회 성공
        data:
          $ref: '#/components/schemas/LoopyLevelResult'

    StampBookExtensionResult:
      type: object
      properties:
        newExpiresAt:
          type: string
          format: date-time
          example: "2025-08-14T00:00:00.000Z"
        extendedAt:
          type: string
          format: date-time
          example: "2025-07-31T10:00:00.000Z"
        daysUntilExpiration:
          type: integer
          example: 14
        isExpiringSoon:
          type: boolean
          example: false

    StampBookExtensionSuccessResponse:
      type: object
      properties:
        status:
          type: string
          example: SUCCESS
        code:
          type: integer
          example: 200
        message:
          type: string
          example: 스탬프북이 14일 연장되었습니다.
        data:
          $ref: '#/components/schemas/StampBookExtensionResult'

    SystemNotificationDetail:
      type: object
      properties:
        title:
          type: string
          example: 시스템 알림 제목
        content:
          type: string
          example: 시스템 알림 본문

    ChallengeNotificationDetail:
      type: array
      items:
        type: object
        properties:
          id:
            type: integer
          title:
            type: string
          description:
            type: string
          thumbnailUrl:
            type: string
          startDate:
            type: string
            format: date
          endDate:
            type: string
            format: date
          isActive:
            type: boolean

    StampNotificationDetail:
      type: object
      properties:
        id:
          type: integer
        currentCount:
          type: integer
        goalCount:
          type: integer
        rewardDetail:
          type: string
        status:
          type: string
        isCompleted:
          type: boolean
        isConverted:
          type: boolean
        expiresAt:
          type: string
          format: date-time
        lastVisitedAt:
          type: string
          format: date-time
          nullable: true

    ReviewNotificationDetail:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        address:
          type: string

    CouponNotificationDetail:
      type: array
      items:
        type: object
        properties:
          id:
            type: integer
          name:
            type: string
          validDays:
            type: integer
          discountType:
            type: string
          discountValue:
            type: integer
          applicableMenuId:
            type: integer
            nullable: true
          expiredAt:
            type: string
            format: date-time

    UserCoupon:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
        couponTemplateId:
          type: integer
        acquisitionType:
          type: string
          enum: [stamp, promotion]
        status:
          type: string
          enum: [active, used, expired]
        issuedAt:
          type: string
          format: date-time
        expiredAt:
          type: string
          format: date-time
        couponTemplate:
          type: object
          properties:
            id:
              type: integer
            cafeId:
              type: integer
            name:
              type: string
            discountType:
              type: string
              enum: [AMOUNT, PERCENT]
            discountValue:
              type: number
            validDays:
              type: integer
            isActive:
              type: boolean
            expiredAt:
              type: string
              format: date-time

  securitySchemes:
      bearerAuth:
        type: http
        scheme: bearer
        bearerFormat: JWT

tags:
  - name: Users
    description: 사용자 정보 및 설정 관련 API